<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EDCHM">
<title>EDCHM • EDCHM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Open%20Sans-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EDCHM">
<meta property="og:description" content="EDCHM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EDCHM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/EDCHM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/LuckyKanLei/EDCHM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>EDCHM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LuckyKanLei/EDCHM/blob/HEAD/vignettes/EDCHM.Rmd" class="external-link"><code>vignettes/EDCHM.Rmd</code></a></small>
      <div class="d-none name"><code>EDCHM.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LuckyKanLei/EDCHM" class="external-link">EDCHM</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="three-ways-to-obtain-one-model">Three Ways to Obtain One Model<a class="anchor" aria-label="anchor" href="#three-ways-to-obtain-one-model"></a>
</h2>
<p><code>EDCHM</code> provides three methods for obtaining a hydrological model that simulates the hydrological process.</p>
<div class="section level3">
<h3 id="use-the-pre-defined-model">Use the Pre-Defined Model<a class="anchor" aria-label="anchor" href="#use-the-pre-defined-model"></a>
</h3>
<p><code>EDCHM</code> offers three pre-defined models: (Note: models with the <code>_full</code> suffix will return all variables in a <code>list</code>. Otherwise, the standard model returns only the stream flow to speed up the calibration process.)</p>
<ul>
<li>
<code><a href="../reference/modells.html">EDCHM_GR4J()</a></code> and <code><a href="../reference/modells.html">EDCHM_GR4J_full()</a></code>: original GR4J model, same as <code><a href="https://rdrr.io/pkg/airGR/man/RunModel_GR4J.html" class="external-link">airGR::RunModel_GR4J()</a></code>.</li>
<li>
<code><a href="../reference/modells.html">EDCHM_mini()</a></code> and <code><a href="../reference/modells.html">EDCHM_mini_full()</a></code>: a minimal model structure with random process method.</li>
<li>
<code><a href="../reference/modells.html">EDCHM_snow()</a></code> and <code><a href="../reference/modells.html">EDCHM_snow_full()</a></code>: a snow-structure model with random process method.</li>
</ul>
<p>The function arguments will show all the <strong>boundary (input) variable</strong> and <strong>parameters</strong></p>
</div>
<div class="section level3">
<h3 id="create-a-model-with-a-pre-defined-model-structure">Create a Model with a Pre-Defined Model Structure<a class="anchor" aria-label="anchor" href="#create-a-model-with-a-pre-defined-model-structure"></a>
</h3>
<p>The <code><a href="../reference/build_modell.html">build_modell()</a></code> function offers a standard structure that contains 15 processes and 34 sub-structures, which can generate more than ten millions models.</p>
<p>To build a model, you only need to:</p>
<ol style="list-style-type: decimal">
<li>Provide the method name for every process:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## select the process method</span></span>
<span><span class="va">my_process_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> </span>
<span>atmosSnow <span class="op">=</span> <span class="st">"atmosSnow_ThresholdT"</span>,</span>
<span>evatransPotential <span class="op">=</span> <span class="st">"NULL"</span>,</span>
<span>evatransLand <span class="op">=</span> <span class="st">"NULL"</span>,</span>
<span>evatransSoil <span class="op">=</span> <span class="st">"evatransActual_SupplyRatio"</span>,</span>
<span>intercep <span class="op">=</span> <span class="st">"NULL"</span>,</span>
<span>snowMelt <span class="op">=</span> <span class="st">"snowMelt_Kustas"</span>,</span>
<span>infilt <span class="op">=</span> <span class="st">"infilt_AcceptRatio"</span>,</span>
<span>percola <span class="op">=</span> <span class="st">"percola_SupplyRatio"</span>,</span>
<span>inteflow <span class="op">=</span> <span class="st">"NULL"</span>,</span>
<span>capirise <span class="op">=</span> <span class="st">"NULL"</span>,</span>
<span>baseflow <span class="op">=</span> <span class="st">"baseflow_SupplyRatio"</span>,</span>
<span>lateral <span class="op">=</span> <span class="st">"lateral_GR4Jfix"</span>,</span>
<span>confluenLand <span class="op">=</span> <span class="st">"confluenIUH_Kelly"</span>,</span>
<span>confluenSoil <span class="op">=</span> <span class="st">"NULL"</span>,</span>
<span>confluenGround <span class="op">=</span> <span class="st">"confluenIUH_Nash"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create the model with <code><a href="../reference/build_modell.html">build_modell()</a></code>, this function will return the <strong>rang of all parameters</strong> in R-Space and a <strong>.cpp-file</strong> in a folder, which represents the model.</li>
</ol>
<p><strong>NOTE: Make sure that there is no model with the same name in the file path.</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## build</span></span>
<span><span class="va">my_ParamRange</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_modell.html">build_modell</a></span><span class="op">(</span><span class="va">my_process_method</span>, <span class="st">"E:\\Kan_Lei\\try"</span>, <span class="st">"TestModel"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## check</span></span>
<span><span class="va">my_ParamRange</span></span>
<span><span class="co">#&gt;                               min   max</span></span>
<span><span class="co">#&gt; param_atmos_thr_Ts         -1e+00 3.000</span></span>
<span><span class="co">#&gt; param_baseflow_sur_k        1e-02 1.000</span></span>
<span><span class="co">#&gt; param_confluenGround_nas_n  1e+00 8.000</span></span>
<span><span class="co">#&gt; param_confluenLand_kel_k    1e+00 4.000</span></span>
<span><span class="co">#&gt; param_evatrans_sur_k        1e-01 1.000</span></span>
<span><span class="co">#&gt; param_infilt_acr_k          1e-02 1.000</span></span>
<span><span class="co">#&gt; param_lateral_grf_gamma     1e-02 5.000</span></span>
<span><span class="co">#&gt; param_percola_sur_k         1e-02 1.000</span></span>
<span><span class="co">#&gt; param_snow_kus_fE           5e-04 0.003</span></span>
<span><span class="co">#&gt; param_snow_kus_fT           5e-02 1.000</span></span></code></pre></div>
<p>The .cpp-file looks like the <a href="https://github.com/LuckyKanLei/EDCHM/blob/main/src/EDCHM_mini.cpp" class="external-link">source code of EDCHM_mini</a>, which will be shown in the next section on how to use it.</p>
</div>
<div class="section level3">
<h3 id="manually-build-a-model-with-edchm-modules">Manually build a model with EDCHM modules<a class="anchor" aria-label="anchor" href="#manually-build-a-model-with-edchm-modules"></a>
</h3>
<p>Although <code><a href="../reference/build_modell.html">build_modell()</a></code> offers the possibility of generating over a million models, there may still be a requirement to create a model with a different structure. For example, it may involve adding or deleting some processes, or adding more layers.</p>
<p>As shown in the model <a href="https://github.com/LuckyKanLei/EDCHM/blob/main/src/EDCHM_mini.cpp" class="external-link">source code of EDCHM_mini</a>, it is straightforward to assemble a model with EDCHM modules. The steps are as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Select the deciding processes and their methods, the <a href="https://luckykanlei.github.io/EDCHM/reference/index.html" class="external-link">Reference-Page</a> shows all of the processes and process-methods.</p></li>
<li><p>Fill the arguments of the module (function) with specific variables and parameters. The original argument names are well-defined, so they can be used as variable names.</p></li>
</ol>
<p>The function with arguments looks like:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>infilt_UBC<span class="op">(</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  land_water_mm<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  land_impermeableFrac_1<span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  soil_water_mm<span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  soil_capacity_mm<span class="op">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  param_infilt_ubc_P0AGEN</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
<p>The code line in the model source code looks like:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>soil_infilt_mm <span class="op">=</span> infilt_UBC<span class="op">(</span>land_water_mm<span class="op">,</span> land_impermeableFrac_1<span class="op">,</span> soil_water_mm<span class="op">,</span> soil_capacity_mm<span class="op">,</span> param_infilt_ubc_P0AGEN<span class="op">);</span></span></code></pre></div>
<p>In the most Situations the arguments names can be used directly.</p>
<ol start="3" style="list-style-type: decimal">
<li>Set the processing after the module, the relationship between the calculated process-variable and the standard variables.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>soil_infilt_mm <span class="op">=</span> infilt_UBC<span class="op">(</span>land_water_mm<span class="op">,</span> land_impermeableFrac_1<span class="op">,</span> soil_water_mm<span class="op">,</span> soil_capacity_mm<span class="op">,</span> param_infilt_ubc_P0AGEN<span class="op">);</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>soil_water_mm <span class="op">+=</span> soil_infilt_mm<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>land_runoff_mm<span class="op">(</span>i<span class="op">,</span> _<span class="op">)</span> <span class="op">=</span> land_water_mm <span class="op">-</span> soil_infilt_mm<span class="op">;</span></span></code></pre></div>
<p>The infiltration water will infiltrate from the land-layer to the soil-layer, while the remaining water will flow as runoff to the river or catchment outlet. So these two lines will be added in to the model.</p>
<ol start="4" style="list-style-type: decimal">
<li>Complete the boundary conditions (BC) variables (input, meteorological data) in matrix-form. The BC variables are always given as time series, so they must be in matrix form, for example, <code>atmos_precipitation_mm</code> and <code>atmos_potentialEvatrans_mm</code>.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>soil_evatrans_mm <span class="op">=</span> evatransActual_UBC<span class="op">(</span>atmos_potentialEvatrans_mm<span class="op">(</span>i<span class="op">,</span> _<span class="op">),</span> soil_water_mm<span class="op">,</span> soil_capacity_mm<span class="op">,</span> param_evatrans_ubc_gamma<span class="op">);</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>soil_water_mm <span class="op">+=</span> <span class="op">-</span> soil_evatrans_mm<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>land_water_mm <span class="op">=</span> atmos_precipitation_mm<span class="op">(</span>i<span class="op">,</span> _<span class="op">);</span></span></code></pre></div>
<p>Both variables is defined as matrices in input, so the time dimension (index i) must be specified.</p>
<ol start="5" style="list-style-type: decimal">
<li>Complete the outflow variables in matrix-form. The outflow variables refer to the variables that will flow to the catchment outlet through “routing”, for example, <code>land_runoff_mm</code> and <code>ground_baseflow_mm</code>.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>land_runoff_mm<span class="op">(</span>i<span class="op">,</span> _<span class="op">)</span> <span class="op">=</span> land_water_mm <span class="op">-</span> soil_infilt_mm<span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ground_baseflow_mm<span class="op">(</span>i<span class="op">,</span> _<span class="op">)</span> <span class="op">=</span> ground_baseflow_mm<span class="op">(</span>i<span class="op">,</span> _<span class="op">)</span> <span class="op">+</span> baseflow_temp<span class="op">;</span></span></code></pre></div>
<p>Both variables must be declared as matrices, so the time dimension (index i) must be specified.</p>
<ol start="6" style="list-style-type: decimal">
<li>Define all the parameters and input (BC) variables as arguments and declare all the other variables.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>NumericMatrix EDCHM_mini<span class="op">(</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">// basci parameter</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n_time<span class="op">,</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n_spat<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">// BC data (Input)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>NumericMatrix atmos_potentialEvatrans_mm<span class="op">,</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>NumericMatrix atmos_precipitation_mm<span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">// parameters, that schould be estimated and innitial condition (IC) data</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>NumericVector ground_capacity_mm<span class="op">,</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>NumericVector ground_water_mm<span class="op">,</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>NumericVector land_impermeableFrac_1<span class="op">,</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>NumericVector soil_capacity_mm<span class="op">,</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>NumericVector soil_potentialPercola_mm<span class="op">,</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>NumericVector soil_water_mm<span class="op">,</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">// parameters, that need to calibrated</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>NumericVector confluenLand_responseTime_TS<span class="op">,</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>NumericVector confluenGround_responseTime_TS<span class="op">,</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>NumericVector param_baseflow_grf_gamma<span class="op">,</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>NumericVector param_confluenLand_kel_k<span class="op">,</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>NumericVector param_evatrans_ubc_gamma<span class="op">,</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>NumericVector param_infilt_ubc_P0AGEN<span class="op">,</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>NumericVector param_percola_arn_k<span class="op">,</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>NumericVector param_percola_arn_thresh</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">// declare the vector-variable, that contain only on dimension time like confluenLand_iuh_1 and confluenGround_iuh_1</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">// or spat like land_water_mm, soil_evatrans_mm, soil_infilt_mm and soil_percolation_mm</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>NumericVector land_water_mm<span class="op">,</span> soil_evatrans_mm<span class="op">,</span> soil_infilt_mm<span class="op">,</span> soil_percolation_mm<span class="op">,</span> confluenLand_iuh_1<span class="op">,</span> confluenGround_iuh_1<span class="op">;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">// declare the matric-variable, that contain two dimensions time and spat</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>NumericMatrix land_runoff_mm<span class="op">(</span>n_time<span class="op">,</span> n_spat<span class="op">),</span> ground_baseflow_mm<span class="op">(</span>n_time<span class="op">,</span> n_spat<span class="op">),</span> confluen_streamflow_mm<span class="op">(</span>n_time<span class="op">,</span> n_spat<span class="op">);</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> confluen_streamflow_mm<span class="op">;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>With these six steps, we can build a new model, but it is important to ensure that the logic of relationships between variables is correct.</p>
</div>
</div>
<div class="section level2">
<h2 id="run-the-model">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h2>
<div class="section level3">
<h3 id="run-the-pre-defined-model-from-edchm">Run the pre-defined model from EDCHM<a class="anchor" aria-label="anchor" href="#run-the-pre-defined-model-from-edchm"></a>
</h3>
<p>The pre-defined model can be used like normal functions. You just need to provide the input data and the parameters <strong>in the correct format</strong> as specified in the function arguments. For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## reform the data into matrix</span></span>
<span><span class="va">mat_EDCHM_TestData</span> <span class="op">&lt;-</span> <span class="va">EDCHM_TestData</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Parameter initial</span></span>
<span><span class="va">Param_mini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>land_impermeableFrac_1 <span class="op">=</span> <span class="fl">.5</span>, </span>
<span>                     soil_potentialPercola_mm <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                     confluenLand_responseTime_TS <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                     confluenGround_responseTime_TS <span class="op">=</span> <span class="fl">4</span>, </span>
<span>                     Param_baseflow_grf_gamma <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                     Param_confluenLand_kel_k <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                     Param_evatrans_ubc_gamma <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>                     Param_infilt_ubc_P0AGEN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                     Param_percola_arn_k <span class="op">=</span> <span class="fl">.6</span>, </span>
<span>                     Param_percola_arn_thresh <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## run the model</span></span>
<span><span class="va">test_Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modells.html">EDCHM_mini</a></span><span class="op">(</span></span>
<span>    <span class="fl">180</span>, <span class="co"># n_time, number of time step</span></span>
<span>    <span class="fl">1</span>, <span class="co"># n_spat, number of spatial unit</span></span>
<span>    <span class="va">mat_EDCHM_TestData</span><span class="op">[</span>,<span class="st">"EC"</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># atmos_potentialEvatrans_mm, Input matrix</span></span>
<span>    <span class="va">mat_EDCHM_TestData</span><span class="op">[</span>,<span class="st">"PA2"</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># atmos_precipitation_mm, Input matrix</span></span>
<span>    <span class="fl">200.</span>, <span class="co"># ground_capacity_mm, (physical based) parameter</span></span>
<span>    <span class="fl">100.</span>, <span class="co"># ground_water_mm, initial condition</span></span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"land_impermeableFrac_1"</span><span class="op">]</span>, </span>
<span>    <span class="fl">200.</span>, <span class="co"># soil_capacity_mm, (physical based) parameter</span></span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"soil_potentialPercola_mm"</span><span class="op">]</span>, </span>
<span>    <span class="fl">100.</span>, <span class="co"># soil_water_mm, initial condition</span></span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"confluenLand_responseTime_TS"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"confluenGround_responseTime_TS"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"Param_baseflow_grf_gamma"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"Param_confluenLand_kel_k"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"Param_evatrans_ubc_gamma"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"Param_infilt_ubc_P0AGEN"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"Param_percola_arn_k"</span><span class="op">]</span>, </span>
<span>    <span class="va">Param_mini</span><span class="op">[</span><span class="st">"Param_percola_arn_thresh"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The input (boundary condition) data, including precipitation (P) and potential evapotranspiration (PET), as well as the simulated model result stream flow (contribution in mm/TS, equivalent to precipitation) (Q), are shown below:</p>
<p><img src="EDCHM_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="run-the-model-with-cpp-source-code">Run the model with cpp source code<a class="anchor" aria-label="anchor" href="#run-the-model-with-cpp-source-code"></a>
</h3>
<p>If the model is still in CPP source code, you first need to compile it into a function using the <code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code> function. For example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">sourceCpp</a></span><span class="op">(</span><span class="st">"path/to/your/model.cpp"</span><span class="op">)</span></span></code></pre></div>
<p>Once the model is compiled, you can use it as a normal function by providing the input data and parameters in the correct format.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kan Lei.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
